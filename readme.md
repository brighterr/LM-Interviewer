# Interview Bot 项目文件功能总结
# Interview Bot 项目结构图

```plaintext
+-------------------+
|     app.py        |  ◄── 主程序入口，启动 Flask 应用，处理路由和音频数据
+-------------------+
        │
        ├───────────────► +-------------------+
        │                |     asr.py        |  ◄── 自动语音识别模块，处理音频数据
        │                +-------------------+
        │
        ├───────────────► +-------------------+
        │                | dialogue_policy.py|  ◄── 对话策略模块，控制访谈流程
        │                +-------------------+
        │
        ├───────────────► +-------------------+
        │                |    utils.py       |  ◄── 工具函数集合，提供日志和随机字符串生成
        │                +-------------------+
        │
        ├───────────────► +-------------------+
        │                |  query_gpt.py     |  ◄── 调用 GPT 模型生成回答
        │                +-------------------+
        │
        ├───────────────► +-------------------+
        │                |   prompts.py      |  ◄── 存储访谈提示和系统消息模板
        │                +-------------------+
        │
        ├───────────────► +-------------------+
        │                | audio_service.py  |  ◄── 音频服务模块，处理文本到语音转换
        │                +-------------------+
        │
        ├───────────────► +-------------------+
        │                | config_example.py |  ◄── 配置文件模板，存储服务配置信息
        │                +-------------------+
        │
        └───────────────► +-------------------+
                          |   db_access.py    |  ◄── 数据库访问模块，管理数据存储
                          +-------------------+     
```                
## `app.py`
**功能**：主程序入口，负责启动 Flask 应用。

**主要职责**：
- 定义 Flask 应用的路由，处理用户请求。
- 集成 SocketIO 用于实时通信。
- 调用其他模块（如 `dialogue_policy`、`db_access` 等）实现访谈流程。
- 提供访谈页面、创建访谈量表页面、恢复访谈页面和查看访谈结果页面的路由。
- 处理音频数据（通过 `socketio`），调用 ASR 模块进行语音识别。

## `asr.py`
**功能**：自动语音识别（ASR）模块。

**主要职责**：
- 使用 WebSocket 与语音识别服务进行通信。
- 将音频数据分段发送到 ASR 服务，并接收识别结果。
- 提供 `asr` 函数，用于将音频数据转换为文本。

## `dialogue_policy.py`
**功能**：对话策略模块，控制访谈流程。

**主要职责**：
- 定义访谈的三个状态：分析状态、提问状态和总结状态。
- 根据当前状态和用户输入，调用 GPT 模型生成回答。
- 提供 `conduct_interview` 函数，用于处理用户消息并更新访谈状态。
- 提供 `analyze_scale` 函数，用于分析访谈量表并生成初始对话内容。

## `utils.py`
**功能**：工具函数集合。

**主要职责**：
- 提供日志记录功能，包括读取、写入和记录错误。
- 提供生成随机字符串的函数，用于生成访谈 ID 等。

## `query_gpt.py`
**功能**：调用 GPT 模型生成回答。

**主要职责**：
- 使用 Azure OpenAI 服务调用 GPT 模型。
- 提供 `query` 函数，用于将对话内容发送到 GPT 模型并获取回答。
- 提供 `add_user_msg` 和 `add_model_msg` 函数，用于将用户和模型的消息添加到对话历史中。

## `prompts.py`
**功能**：存储访谈提示和系统消息模板。

**主要职责**：
- 定义访谈开始、提问、总结等阶段的提示信息。
- 提供系统消息模板，用于引导访谈流程。

## `audio_service.py`
**功能**：音频服务模块，用于文本到语音（TTS）的转换。

**主要职责**：
- 调用外部 API 将文本转换为语音。
- 提供 `text_to_speech` 函数，用于生成语音数据。

## `config_example.py`
**功能**：配置文件模板。

**主要职责**：
- 提供 Flask 应用、ASR 服务、TTS 服务和 GPT 模型的配置信息。
- 需要用户根据实际情况填写配置信息。

## `db_access.py`
**功能**：数据库访问模块。

**主要职责**：
- 提供数据库连接和操作函数。
- 管理访谈量表、访谈记录和访谈报告的数据存储。
- 提供创建表、插入数据、查询数据和更新数据的功能。

# 总结
这些文件共同构成了一个完整的访谈机器人系统，支持文本和语音交互，能够根据预设的访谈量表自动引导访谈流程，并生成访谈总结报告。每个模块都有明确的职责，相互协作完成整个访谈流程。

---

curl http://10.77.110.129:8000/v1/chat/completions -H "Content-Type: application/json" -d '{
  "model": "/home/zhangyuheng/.cache/modelscope/hub/Qwen/Qwen2.5-7B-Instruct",
  "messages": [
    {"role": "system", "content": "You are Qwen, created by Alibaba Cloud. You are a helpful assistant."},
    {"role": "user", "content": ""}
  ],
  "temperature": 0.7,
  "top_p": 0.8,
  "repetition_penalty": 1.05,
  "max_tokens": 512
}'

http://127.0.0.1:5000/interview?scale=yBs4Qstu